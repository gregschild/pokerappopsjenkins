stage('Build') {


    "app" {
          node('standard'){

            git 'https://github.com/gregschild/pokerprojectops.git'
            sh 'curl -L https://www.opscode.com/chef/install.sh | sudo bash'
            sh 'curl https://omnitruck.chef.io/install.sh | sudo bash -s -- -p chefdk -c stable -v 0.16.28'
            sh 'sudo hostname greg.dev'
            sh 'sudo chef-client --local-mode --runlist \'recipe[webserver]\''
            sh 'rm -rf /var/www/html'
            sh 'git clone https://github.com/alanbonhamsky/pokergamefront.git /var/www/html'
            sh 'cat /var/www/html/index.html'
              }
          },
      "api" {
          node('standard') {

            git 'https://github.com/gregschild/pokerprojectops.git'
            sh 'curl -L https://www.opscode.com/chef/install.sh | sudo bash'
            sh 'curl https://omnitruck.chef.io/install.sh | sudo bash -s -- -p chefdk -c stable -v 0.16.28'
            sh 'sudo hostname greg.dev'
            sh 'sudo chef-client --local-mode --runlist \'recipe[webserver]\''
            sh 'rm -rf /var/www/html'
            sh 'git clone https://github.com/nathn123/PokerGame-API.git /var/www/html'
            sh 'cat /var/www/html/app.js'
          }
        },
      "db" {

           node('standard') {


             git 'https://github.com/gregschild/pokerprojectops.git'
             sh 'curl -L https://www.opscode.com/chef/install.sh | sudo bash'
             sh 'curl https://omnitruck.chef.io/install.sh | sudo bash -s -- -P chefdk -c stable -v 0.16.28'
             sh 'sudo hostname greg.dev'
             sh 'sudo chef-client --local-mode --runlist \'recipe[database]\''
           }

       }


   )

 }

 stage('Deploy') {

   parallel (

       "app" {

           node('greg-app-prod') {

             git 'https://github.com/gregschild/pokerprojectops.git'
             sh 'curl -L https://www.opscode.com/chef/install.sh | sudo bash'
             sh 'curl https://omnitruck.chef.io/install.sh | sudo bash -s -- -P chefdk -c stable -v 0.16.28'
             sh 'sudo hostname greg.dev'
             sh 'sudo chef-client --local-mode --runlist \'recipe[webserver]\''
             sh 'rm -rf /var/www/html'
             sh 'git clone https://github.com/alanbonhamsky/pokergamefront.git /var/www/html'

           }

       },

       "api" {

           node('greg-api-prod') {

             git 'https://github.com/gregschild/pokerprojectops.git'
             sh 'curl -L https://www.opscode.com/chef/install.sh | sudo bash'
             sh 'curl https://omnitruck.chef.io/install.sh | sudo bash -s -- -P chefdk -c stable -v 0.16.28'
             sh 'sudo hostname greg.dev'
             sh 'sudo chef-client --local-mode --runlist \'recipe[webserver]\''
             sh 'rm -rf /var/www/html'
             sh 'git clone https://github.com/nathn123/PokerGame-API.git /var/www/html'
             sh 'pm2 kill'
             sh 'pm2 start /var/www/html/app.js'

           }

       },

       "db" {

           node('greg-db-prod') {

             git 'https://github.com/gregschild/pokerprojectops.git'
             sh 'curl -L https://www.opscode.com/chef/install.sh | sudo bash'
             sh 'curl https://omnitruck.chef.io/install.sh | sudo bash -s -- -P chefdk -c stable -v 0.16.28'
             sh 'sudo hostname greg.dev'
             sh 'sudo chef-client --local-mode --runlist \'recipe[database]\''

           }

       }




 }
